<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kael Lovato - Terminal</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div id="terminal">
    <div>Bem-vindo ao portfólio de Kael Lovato</div>
    <div>Digite <code>help</code> para ver os comandos disponíveis.</div>
    <div id="history"></div>
    <div class="input-line">
      <span class="prompt">&gt;</span>
      <input autocomplete="off" type="text" id="command" class="cmd-input" autofocus />
    </div>
  </div>

<audio id="keySound" preload="auto">
  <source src="KeyboardType.wav" type="audio/wav">
</audio>

<audio id="errorSound" preload="auto">
  <source src="error.ogg" type="audio/ogg">
</audio>

<audio id="clearSound" preload="auto">
  <source src="ClearTerminal.wav" type="audio/wav">
</audio>

<script>
  const history = document.getElementById('history');
  const commandInput = document.getElementById('command');
  const keySound = document.getElementById('keySound');
  const errorSound = document.getElementById('errorSound');
  const clearSound = document.getElementById('clearSound');

  let terminalState = "root";

  const commands = {
    help: `Comandos disponíveis:
    about       - Sobre mim
    projects    - Meus projetos
    certs       - Certificados
    contact     - Contato
    gui         - Abrir interface gráfica
    clear       - Limpar terminal`,
    
    about: `<img src="KaelBg.png" alt="Kael Lovato">Sou Kael Lovato, desenvolvedor apaixonado por tecnologia, aprendizado contínuo e experiências imersivas.<br>Trabalho com jogos, web e design interativo.`,

    projects: 'PROJECTS_SUBMENU',

    certs: `Certificados:\n  CS50 – Introduction to Computer Science – HarvardX\n  Link: https://cs50.harvard.edu/certificates/SEU_CERTIFICADO`,

    contact: `Contato:
    Email: kaellovato5@gmail.com
    LinkedIn: linkedin.com/in/kael-lovato`,

    gui: 'REDIRECT_GUI',
    clear: 'CLEAR'
  };

  function typeEffect(text, element, callback) {
      // Índice para acompanhar a posição atual do caractere no texto
      let i = 0;
      // Flag para indicar se estamos dentro de uma tag HTML (entre < e >)
      let isTag = false;
      // Buffer para acumular os caracteres da tag HTML enquanto ela não termina
      let tagBuffer = "";

      // Intervalo que executa a cada 10ms para simular a digitação
      const interval = setInterval(() => {
        // Pega o caractere atual do texto
        const char = text.charAt(i);

        // Se encontrar um <, significa que uma tag HTML está começando
        if (char === "<") {
          isTag = true;
        }

        // Se estiver dentro de uma tag HTML
        if (isTag) {
          // Acumula o caractere atual no buffer da tag
          tagBuffer += char;
          // Se encontrar o fechamento da tag >
          if (char === ">") {
            // Adiciona a tag completa ao conteúdo HTML do elemento
            element.innerHTML += tagBuffer;
            // Limpa o buffer da tag para o próximo uso
            tagBuffer = "";
            // Marca que a tag terminou
            isTag = false;
          }
        } else {
          // Se não estiver em uma tag, adiciona o caractere normal ao elemento
          element.innerHTML += char;

          // A cada 5 caracteres (excluindo espaços e quebras de linha), toca um som de tecla
          if (![' ', '\n'].includes(char) && i % 5 === 0) {
            keySound.currentTime = 0;   // Reinicia o som para tocar desde o início
            keySound.volume = 0.1;      // Define o volume do som
            keySound.play().catch(() => {}); // Toca o som, ignorando erros se não puder tocar
          }
        }

        // Passa para o próximo caractere
        i++;

        // Se chegou ao final do texto
        if (i >= text.length) {
          // Para o intervalo de digitação
          clearInterval(interval);
          // Se foi passada uma função callback, chama ela
          if (callback) callback();
        }
      }, 10); // intervalo de 10 milissegundos entre cada caractere
  }

  function clearWithGlitch(callback) {
    const lines = [...history.children];
    let currentLine = lines.length - 1;
    function eraseLine() {
      if (currentLine < 0) {
        if (callback) callback();
        return;
      }
      const line = lines[currentLine];
      line.classList.add("glitch-out");
      clearSound.currentTime = 0;
      clearSound.volume = 0.5;
      clearSound.play().catch(() => {});
      setTimeout(() => {
        line.remove();
        currentLine--;
        eraseLine();
      }, 130);
    }
    eraseLine();
  }

  function showHelp(callback) {
  const helpMessage = `Comandos disponíveis:
    about       - Sobre mim
    projects    - Meus projetos
    certs       - Certificados
    contact     - Contato
    gui         - Abrir interface gráfica
    clear       - Limpar terminal`;

  const helpResponse = document.createElement('div');
  helpResponse.style.whiteSpace = 'pre-wrap';
  history.appendChild(helpResponse);
  typeEffect(helpMessage, helpResponse, callback);
}


  function showProjectMenu(response) {
    terminalState = "projects";
    typeEffect("Projetos disponíveis:\n[1] Experiência em Realidade Virtual\n[2] Dashboard Web\n[3] Terminal Interativo\nDigite o número ou 'exit' para voltar.", response);
  }

  function showProjectDetails(option, response) {
    let content = '';
    switch(option) {
      case '1':
        content = '<img src="rvprojeto.png" alt="Kael Lovato" style="max-width: 750px;">Projeto: Experiência em Realidade Virtual\nFeito na Unreal Engine 5, uma plataforma renomada de criação de jogos, realizei um projeto de aptidão profissional com o intuito de recriar o Terremoto de Lisboa em 1755.\n';
        break;
      case '2':
        content = 'Projeto: Dashboard Web\nAutenticação, gráficos e responsividade.\n[Imagem: Dashboard.png]';
        break;
      case '3':
        content = 'Projeto: Terminal Interativo\nEste portfólio com som, animações e navegação textual.\n[Imagem: Terminal.png]';
        break;
      default:
        content = 'Comando inválido. Use 1, 2, 3 ou exit.';
    }
    typeEffect(content, response);
  }

  commandInput.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      const input = commandInput.value.trim();
      if (!input) return;

      const output = document.createElement('div');
      output.innerHTML = `\n> ${input}`;
      history.appendChild(output);

      const response = document.createElement('div');
      history.appendChild(response);

    if (terminalState === "projects") {
      if (input.toLowerCase() === "exit") {
        terminalState = "root";
        
        typeEffect("Saindo da seção de projetos...", response, () => {
        setTimeout(() => {
          clearWithGlitch(() => {
              showHelp();
            });
          }, 500);
        });
        } else {
          showProjectDetails(input, response);
        }
      } else {
        const cmd = commands[input.toLowerCase()];
        if (cmd === 'CLEAR') {
          clearWithGlitch();
        } else if (cmd === 'REDIRECT_GUI') {
          window.location.href = 'gui.html';
        } else if (cmd === 'PROJECTS_SUBMENU') {
          showProjectMenu(response);
        } else if (cmd) {
          typeEffect(cmd, response);
        } else {
          errorSound.currentTime = 0;
          errorSound.volume = 1.0;
          errorSound.play().catch(() => {});
          typeEffect(`Comando não reconhecido: ${input}`, response);
        }
      }

      commandInput.value = '';
      window.scrollTo(0, document.body.scrollHeight);
    }
  });
</script>
</body>
</html>
